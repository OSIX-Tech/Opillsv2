---
import PhoneIcon from '../components/PhoneIcon.astro';
import ArrowRightIcon from '../components/ArrowRightIcon.astro';

---
<section id="hero-section" class="font-sans text-center py-16 px-4 overflow-x-hidden">
  <div class="w-full max-w-7xl mx-auto">
    <div>
      <h1 class="text-5xl md:text-7xl font-bold leading-tight">
        The most advanced<br />
        intelligent<br />
        <span class="text-brand-teal font-script">Dashboard</span>
      </h1>
      <div class="flex flex-col sm:flex-row justify-center items-center gap-4 mt-8">
        <button class="w-full sm:w-auto flex items-center justify-center gap-2 bg-brand-teal text-white font-bold py-3 px-6 rounded-full shadow-lg hover:shadow-xl transition-shadow">
          Contact
          <div class="bg-white text-brand-teal rounded-full p-1">
            <PhoneIcon class="w-5 h-5" />
          </div>
        </button>
        <button class="w-full sm:w-auto flex items-center justify-center gap-2 bg-white text-gray-700 font-bold py-3 px-6 rounded-full shadow-lg hover:shadow-xl transition-shadow border border-gray-200">
          Learn more
          <div class="bg-brand-teal text-white rounded-full p-1">
            <ArrowRightIcon class="w-5 h-5" />
          </div>
        </button>
      </div>
    </div>

    <div class="mt-12 container mx-auto">
      <div class="flex flex-wrap lg:flex-nowrap items-center justify-center gap-x-8 gap-y-12">
        <div class="logo-placeholder w-40 shrink-0 order-2 lg:order-1 transition-opacity duration-300">
          <div class="bg-gray-200 h-16 rounded-lg flex items-center justify-center">
            <p class="text-gray-500 text-sm">EIT Logo</p>
          </div>
        </div>
        
        <div 
          id="mockup-container" 
          class="w-full max-w-4xl order-1 lg:order-2 rounded-xl border-4 border-gray-300 overflow-hidden mx-auto"
        >
          <video
            id="mockup-video"
            src="/Opillsv2/wow.mp4"
            poster="/foto.jpg"
            muted
            loop
            autoplay
            playsinline
            preload="auto"
            class="w-full h-full object-cover object-top"
          ></video>
        </div>

        <div class="logo-placeholder w-40 shrink-0 order-3 lg:order-3 transition-opacity duration-300">
          <div class="bg-gray-200 h-16 rounded-lg flex items-center justify-center">
            <p class="text-gray-500 text-sm">avte Logo</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  const heroSection = document.getElementById('hero-section');
  if (heroSection) {
    const title = heroSection.querySelector('h1');
    const buttons = heroSection.querySelectorAll('button');
    const mockupContainer = document.getElementById('mockup-container');
    const mockupVideo = document.getElementById('mockup-video') as HTMLVideoElement;
    const logoPlaceholders = document.querySelectorAll('.logo-placeholder');

    // --- 1. Animación de entrada inicial ---
    const entryTl = gsap.timeline({ defaults: { ease: 'power3.out', duration: 1 } });
    entryTl.from(title, { opacity: 0, y: 30, delay: 0.2 })
           .from(buttons, { opacity: 0, y: 20, stagger: 0.15 }, "-=0.7");

    // --- 2. Animación de scroll (scrub) ---
    if (mockupContainer && mockupVideo && logoPlaceholders.length > 0) {
      
      ScrollTrigger.matchMedia({
        // Escritorio
        "(min-width: 768px)": function() {
          const scrubTl = gsap.timeline({
            scrollTrigger: {
              trigger: heroSection,
              start: "top top",
              end: "bottom center",
              scrub: 1.2,
            },
            defaults: { ease: "power1.inOut" }
          });
          
          scrubTl.fromTo(mockupContainer, 
            { height: '40vh', scale: 0.9, maskImage: 'linear-gradient(to bottom, black 60%, transparent 100%)' },
            { height: '504px', scale: 1.2, maskImage: 'linear-gradient(to bottom, black 100%, transparent 100%)' }
          )
          .fromTo(mockupVideo, { scale: 1.3 }, { scale: 1 }, "<")
          .to([title, buttons], { opacity: 0, y: -50 }, "<")
          .to(logoPlaceholders, { opacity: 0 }, "<");
        },
        // Móvil
        "(max-width: 767px)": function() {
          const scrubTl = gsap.timeline({
            scrollTrigger: {
              trigger: heroSection,
              start: "top top",
              end: "bottom center",
              scrub: 1.2,
            },
            defaults: { ease: "power1.inOut" }
          });
          
          scrubTl.fromTo(mockupContainer, 
            { height: '30vh', scale: 0.9, maskImage: 'linear-gradient(to bottom, black 60%, transparent 100%)' },
            { height: '350px', scale: 1.1, maskImage: 'linear-gradient(to bottom, black 100%, transparent 100%)' } // Más pequeño
          )
          .fromTo(mockupVideo, { scale: 1.3 }, { scale: 1 }, "<")
          .to([title, buttons], { opacity: 0, y: -20 }, "<") // Menos desplazamiento
          .to(logoPlaceholders, { opacity: 0 }, "<");
        }
      });


      // --- 3. Control de reproducción del video ---
      ScrollTrigger.create({
        trigger: mockupVideo,
        start: 'top bottom',
        end: 'bottom top',
        onEnter: () => mockupVideo.play().catch(() => {}),
        onLeave: () => mockupVideo.pause(),
        onEnterBack: () => mockupVideo.play().catch(() => {}),
        onLeaveBack: () => mockupVideo.pause(),
      });
    }
  }
</script>

 